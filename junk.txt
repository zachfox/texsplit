
def build_dictionary(ihandle):
    '''
    Build a dictionary that contains 
    section names, figure labels, etc.
    '''
    splits = {'\usepackage':'packages',r' \newcommand':'commands',
             '\section':'sections',r'\begin{document}':'doc_lines',
             '\end{document}':'doc_lines'}
    
    information = {} 
    lindex = 0
    for line in ihandle:
        for command in splits:
            if command in line:
                try: 
                    information[splits[command]].append(lindex)
                except:
                    information[splits[command]]=[lindex]
        lindex +=1
    for key in information:
        information[key].append(-1)

    return information

def write_lines(ihandle,lines,ohandle):
    '''
    Writes the lines from ihandle to ohandle
    '''
    ihandle.seek(0)
    lindex = 0; chunk = 0
    for line in ihandle:
        for i in range(len(lines)/2):
            while lindex>=lines[2*i] and lindex<lines[2*i+1]:
                if lindex == lines[0]:
                    ohandle.write(line)                  
                ohandle.write(line)
            lindex +=1 
    ohandle.close() 
            
    
def build_files(ihandle,information):
    '''
    Take the information from the file and write to seperate .tex files and
    build a main.tex file that will compile your document. 
    ''' 
    #first, make the directory and generate file handles
    os.mkdir('sections')
    for key in information:
        ohandle = open('sections/'+key+'.tex','w')
        write_lines(ihandle,information[key],ohandle)
